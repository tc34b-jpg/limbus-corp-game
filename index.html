<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>ManoBit: Clash & Defense</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Press+Start+2P&display=swap');
        :root { --bg: #05050a; --panel: #0d0d16; --accent: #ffb347; --win: #4CAF50; --lose: #f44336; --ego: #a333ff; --sp: #33aaff; --border: #2a2a3a; }
        body { margin: 0; background: var(--bg); color: #e0e0f8; font-family: 'Roboto', sans-serif; overflow: hidden; text-transform: uppercase; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .screen { display: none; width: 98%; max-width: 1200px; height: 95vh; background: var(--panel); border-radius: 15px; border: 2px solid var(--border); flex-direction: column; align-items: center; padding: 15px; box-sizing: border-box; position: relative; }
        .active { display: flex; }
        h1 { font-family: 'Press Start 2P'; font-size: 0.9rem; color: var(--accent); margin-bottom: 10px; }
        
        .battle-grid { display: flex; width: 100%; flex: 1; gap: 20px; }
        .squad-side { width: 60%; display: grid; grid-template-columns: repeat(3, 2fr); gap: 10px; align-content: center; }
        .enemy-side { width: 40%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(255,0,0,0.05); border-radius: 20px; border: 1px solid #400; }
        
        .unit-card { background: #08080f; border: 2px solid var(--border); border-radius: 10px; padding: 8px; text-align: center; transition: 0.3s; position: relative; }
        .unit-card.target { border-color: var(--lose); box-shadow: 0 0 15px var(--lose); }
        .unit-card.acting { border-color: var(--accent); transform: scale(1.05); }
        .unit-card.defending { border-color: #555; background: #1a1a1a; }

        .bar { width: 100%; height: 6px; background: #000; border-radius: 3px; overflow: hidden; margin: 3px 0; }
        .bar-fill { height: 100%; transition: 0.4s; }
        
        #coin-box { position: absolute; top: 30%; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; z-index: 100; pointer-events: none; }
        .v-coin { width: 55px; height: 55px; border-radius: 50%; border: 3px solid var(--accent); background: #222; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: bold; }
        .spin { animation: flip 0.15s infinite linear; }
        .h { background: var(--win); box-shadow: 0 0 10px var(--win); } 
        .t { background: var(--lose); opacity: 0.5; }
        @keyframes flip { from { transform: rotateY(0deg); } to { transform: rotateY(360deg); } }

        .cmd-panel { width: 100%; background: #030308; border-top: 3px solid var(--accent); padding: 15px; box-sizing: border-box; border-radius: 20px 20px 0 0; }
        .skill-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; }
        .btn-sk { background: #161625; color: #fff; border: 1px solid #444; padding: 10px; border-radius: 8px; cursor: pointer; font-size: 0.5rem; font-family: 'Press Start 2P'; line-height: 1.4; }
        .btn-sk:hover { border-color: var(--accent); background: #22223a; }
        
        #log { width: 100%; height: 60px; background: #000; margin-top: 10px; padding: 8px; font-size: 0.7rem; color: #999; overflow-y: auto; border: 1px solid #333; }
        .target-indicator { position: absolute; top: -20px; left: 50%; transform: translateX(-50%); color: var(--lose); font-weight: bold; font-size: 0.6rem; }
    </style>
</head>
<body>

    <div id="scr-sel" class="screen active">
        <h1>SQUAD SELECTION [12 SINNERS READY]</h1>
        <div id="grid-sel" style="display:grid; grid-template-columns:repeat(4,1fr); gap:10px; width:100%; overflow-y:auto; flex:1;"></div>
        <button onclick="deploy()" id="btn-deploy" style="margin-top:20px; padding:15px 40px; cursor:pointer; font-family:'Press Start 2P'; background:var(--win); border:none; color:white;" disabled>START MISSION</button>
    </div>

    <div id="scr-bat" class="screen">
        <div id="coin-box"></div>
        <div class="battle-grid">
            <div id="squad-area" class="squad-side"></div>
            <div class="enemy-side">
                <div style="font-size:4rem">ðŸ‘¹</div>
                <div style="color:var(--lose); font-weight:bold; font-size:0.8rem;">CLOCKWORK KING [WAW]</div>
                <div class="bar" style="width:80%; height:15px;"><div id="e-hp" class="bar-fill" style="background:var(--lose); width:100%"></div></div>
                <div id="e-hp-txt" style="font-size:0.7rem">10000/10000</div>
                <div id="enemy-intent" style="margin-top:10px; color:var(--accent); font-size:0.7rem; border:1px solid #522; padding:5px;">ATACANDO: ???</div>
            </div>
        </div>
        <div id="ui-cmd" class="cmd-panel" style="visibility:hidden">
            <div style="margin-bottom:8px; font-size:0.6rem; font-family:'Press Start 2P';">COMMANDING: <span id="acting-name" style="color:var(--accent)">-</span></div>
            <div id="skill-list" class="skill-grid"></div>
            <div id="log"></div>
        </div>
    </div>

    <script>
        const sinnersRaw = [
            { n: "Yi Sang", a: "ðŸ‘¤", h: 160, s1:{n:"Poke",b:4,c:2,p:4}, s2:{n:"Crow",b:6,c:3,p:5}, s3:{n:"Execution",b:10,c:2,p:12}, e:{n:"WINGS",b:20,p:30,k:20} },
            { n: "Faust", a: "ðŸ‘©â€ðŸ”¬", h: 180, s1:{n:"Analyze",b:5,c:1,p:10}, s2:{n:"Fluid",b:7,c:2,p:7}, s3:{n:"Insight",b:12,c:2,p:10}, e:{n:"REPRESENT",b:18,p:40,k:25} },
            { n: "Don Q.", a: "ðŸŽ", h: 150, s1:{n:"Gallop",b:3,c:3,p:4}, s2:{n:"Charge",b:8,c:2,p:12}, s3:{n:"La Mancha",b:12,c:1,p:40}, e:{n:"JUSTICE",b:25,p:30,k:20} },
            { n: "Ryoshu", a: "ðŸ—¡ï¸", h: 140, s1:{n:"Cut",b:5,c:2,p:6}, s2:{n:"Brush",b:8,c:3,p:7}, s3:{n:"F.O.D",b:14,c:2,p:20}, e:{n:"FLAME",b:22,p:45,k:30} },
            { n: "Meursault", a: "ðŸ‘®", h: 250, s1:{n:"Punch",b:8,c:1,p:8}, s2:{n:"Chain",b:6,c:4,p:5}, s3:{n:"Silent",b:12,c:2,p:12}, e:{n:"CHAINS",b:15,p:50,k:20} },
            { n: "Hong Lu", a: "ðŸ‘‘", h: 170, s1:{n:"Fan",b:5,c:2,p:7}, s2:{n:"Cloud",b:8,c:2,p:12}, s3:{n:"Strike",b:12,c:3,p:9}, e:{n:"LANDSCAPE",b:20,p:35,k:25} },
            { n: "Heathcliff", a: "ðŸ˜ ", h: 190, s1:{n:"Bat",b:4,c:2,p:10}, s2:{n:"Revenge",b:10,c:1,p:25}, s3:{n:"Bodysack",b:12,c:3,p:12}, e:{n:"BODYSACK",b:22,p:35,k:20} },
            { n: "Ishmael", a: "âš“", h: 180, s1:{n:"Hook",b:6,c:2,p:8}, s2:{n:"Wave",b:8,c:3,p:8}, s3:{n:"Harpoon",b:12,c:1,p:40}, e:{n:"SNAG",b:24,p:30,k:25} },
            { n: "Rodion", a: "ðŸ”¨", h: 195, s1:{n:"Gamble",b:5,c:2,p:8}, s2:{n:"Axe",b:7,c:2,p:14}, s3:{n:"Poker",b:11,c:4,p:8}, e:{n:"RIMESHANK",b:20,p:40,k:25} },
            { n: "Sinclair", a: "ðŸ”ª", h: 145, s1:{n:"Fear",b:3,c:4,p:5}, s2:{n:"Halberd",b:7,c:3,p:10}, s3:{n:"Blade",b:14,c:2,p:22}, e:{n:"BRANCH",b:26,p:30,k:20} },
            { n: "Outis", a: "ðŸŽ–ï¸", h: 175, s1:{n:"Pierce",b:6,c:2,p:8}, s2:{n:"Strategy",b:9,c:2,p:12}, s3:{n:"Order",b:13,c:3,p:10}, e:{n:"EBONYSTEM",b:21,p:40,k:30} },
            { n: "Gregor", a: "ðŸ›", h: 185, s1:{n:"Claw",b:6,c:2,p:9}, s2:{n:"Insect",b:8,c:3,p:7}, s3:{n:"Apple",b:12,c:2,p:14}, e:{n:"LEGERDEMAIN",b:19,p:40,k:20} }
        ];

        let squad = [], enemy = { h: 10000, max: 10000, atk: 52, targetIdx: 0 }, actions = [], curSinnerIdx = 0;

        // GRID SELECTION
        const g = document.getElementById('grid-sel');
        sinnersRaw.forEach(s => {
            const card = document.createElement('div');
            card.style = "background:#0a0a15; border:1px solid #333; padding:10px; cursor:pointer; text-align:center; border-radius:8px;";
            card.innerHTML = `<div style="font-size:1.5rem">${s.a}</div><div style="font-size:0.5rem; color: #888;">${s.n}</div>`;
            card.onclick = () => {
                let idx = squad.findIndex(i => i.n === s.n);
                if(idx > -1) { squad.splice(idx,1); card.style.borderColor = "#333"; }
                else if(squad.length < 6) { 
                    squad.push({...s, cur:s.h, sp:0, id:Math.random(), deck:[s.s1,s.s1,s.s1,s.s2,s.s2,s.s3], hand:[], defending: false}); 
                    card.style.borderColor = "var(--win)";
                }
                document.getElementById('btn-deploy').disabled = squad.length === 0;
            };
            g.appendChild(card);
        });

        function deploy() {
            document.getElementById('scr-sel').style.display = 'none';
            document.getElementById('scr-bat').classList.add('active');
            renderSquad();
            newTurn();
        }

        function renderSquad() {
            const area = document.getElementById('squad-area'); area.innerHTML = '';
            squad.forEach((s, i) => {
                area.innerHTML += `
                <div class="unit-card" id="u-${i}">
                    <div class="target-indicator" id="tar-${i}"></div>
                    <div style="font-size:2rem">${s.a}</div>
                    <div class="bar"><div id="hp-${i}" class="bar-fill" style="background:var(--win); width:100%"></div></div>
                    <div class="bar" style="height:4px; background:#111"><div id="sp-${i}" class="bar-fill" style="background:var(--sp); width:50%"></div></div>
                </div>`;
            });
        }

        function newTurn() {
            actions = []; curSinnerIdx = 0;
            squad.forEach(s => { s.defending = false; });
            
            // Define Alvo
            enemy.targetIdx = Math.floor(Math.random() * squad.length);
            while(squad[enemy.targetIdx].cur <= 0) enemy.targetIdx = Math.floor(Math.random() * squad.length);
            
            document.querySelectorAll('.target-indicator').forEach(t => t.innerText = '');
            document.querySelectorAll('.unit-card').forEach(u => {u.classList.remove('target'); u.classList.remove('defending');});
            
            document.getElementById(`tar-${enemy.targetIdx}`).innerText = "TARGETED!";
            document.getElementById(`u-${enemy.targetIdx}`).classList.add('target');
            document.getElementById('enemy-intent').innerText = `ATACANDO: ${squad[enemy.targetIdx].n}`;
            
            squad.forEach(s => {
                let d = [...s.deck];
                s.hand = [d.splice(Math.floor(Math.random()*d.length), 1)[0], d.splice(Math.floor(Math.random()*d.length), 1)[0]];
            });

            addLog("DANTE", "< O relÃ³gio gira. Escolha bem. >");
            askAction();
        }

        function askAction() {
            if(curSinnerIdx >= squad.length) return execute();
            const s = squad[curSinnerIdx];
            if(s.cur <= 0) { curSinnerIdx++; return askAction(); }

            document.querySelectorAll('.unit-card').forEach(u => u.classList.remove('acting'));
            document.getElementById(`u-${curSinnerIdx}`).classList.add('acting');
            document.getElementById('ui-cmd').style.visibility = 'visible';
            document.getElementById('acting-name').innerText = s.n;

            const list = document.getElementById('skill-list'); list.innerHTML = '';
            
            // Skills da mÃ£o
            s.hand.forEach(sk => {
                const b = document.createElement('button'); b.className = 'btn-sk';
                b.innerHTML = `${sk.n}<br>${sk.c} COINS<br>${sk.b}+${sk.p}`;
                b.onclick = () => { actions.push({s, sk, type:'atk'}); curSinnerIdx++; askAction(); };
                list.appendChild(b);
            });

            // EGO Permanente
            const ego = document.createElement('button'); ego.className = 'btn-sk'; ego.style.color = "var(--ego)";
            ego.innerHTML = `EGO: ${s.e.n}<br>-${s.e.k} SP`;
            ego.onclick = () => { if(s.sp >= -20) { actions.push({s, sk:{...s.e, c:1}, type:'ego'}); s.sp -= s.e.k; curSinnerIdx++; askAction(); } };
            list.appendChild(ego);

            // DEFESA (Reduz 50% de dano e anula clash)
            const def = document.createElement('button'); def.className = 'btn-sk'; def.style.borderColor = "#888";
            def.innerHTML = `DEFENSE<br>REDUCE 50%`;
            def.onclick = () => { 
                s.defending = true; 
                document.getElementById(`u-${squad.indexOf(s)}`).classList.add('defending');
                actions.push({s, type:'def'}); 
                curSinnerIdx++; askAction(); 
            };
            list.appendChild(def);
        }

        async function execute() {
            document.getElementById('ui-cmd').style.visibility = 'hidden';
            let enemyAttackPrevented = false;

            for(let a of actions) {
                if(enemy.h <= 0) break;
                if(a.type === 'def') continue;

                let isClash = (squad.indexOf(a.s) === enemy.targetIdx);
                let res = await performAction(a, isClash);
                if(isClash && res === 'win') enemyAttackPrevented = true;
            }
            
            if(enemy.h > 0 && !enemyAttackPrevented) {
                let target = squad[enemy.targetIdx];
                if(target.cur > 0) {
                    let dmg = target.defending ? Math.floor(enemy.atk * 0.5) : enemy.atk;
                    target.cur -= dmg;
                    addLog("ENEMY", `Inimigo atingiu ${target.n} por ${dmg}!`);
                    if(!target.defending) target.sp = Math.max(-45, target.sp - 5);
                }
            }
            updateUI();
            if(enemy.h <= 0) addLog("VICTORY", "ANORMALIDADE SUPRIMIDA!");
            else setTimeout(newTurn, 1000);
        }

        async function performAction(a, isClash) {
            const box = document.getElementById('coin-box'); box.innerHTML = '';
            let total = a.sk.b, coins = [], heads = 0;
            let chance = (50 + a.s.sp) / 100;

            for(let i=0; i<a.sk.c; i++) {
                const c = document.createElement('div'); c.className = 'v-coin spin'; c.innerText = '?';
                box.appendChild(c); coins.push(c);
            }

            for(let i=0; i<a.sk.c; i++) {
                await new Promise(r => setTimeout(r, 250));
                let h = Math.random() < chance;
                if(h) { total += a.sk.p; heads++; coins[i].className = 'v-coin h'; coins[i].innerText = 'H'; }
                else { coins[i].className = 'v-coin t'; coins[i].innerText = 'T'; }
            }

            let clashWin = false;
            if(isClash) {
                if(total > enemy.atk) {
                    addLog("CLASH", `${a.s.n} VENCEU! +10 SP`);
                    a.s.sp = Math.min(45, a.s.sp + 10);
                    enemy.h -= (total * 1.5);
                    clashWin = true;
                } else {
                    addLog("CLASH", `${a.s.n} PERDEU! -10 SP`);
                    a.s.sp = Math.max(-45, a.s.sp - 10);
                }
            } else {
                enemy.h -= total;
                addLog("ACTION", `${a.s.n} causou ${total} de dano!`);
            }
            
            a.s.sp = Math.min(45, a.s.sp + (heads * 2));
            updateUI();
            await new Promise(r => setTimeout(r, 500));
            box.innerHTML = '';
            return clashWin ? 'win' : 'lose';
        }

        function updateUI() {
            document.getElementById('e-hp').style.width = (enemy.h/enemy.max*100)+'%';
            document.getElementById('e-hp-txt').innerText = `${Math.max(0, enemy.h)}/${enemy.max}`;
            squad.forEach((s, i) => {
                if(document.getElementById(`hp-${i}`)) {
                    document.getElementById(`hp-${i}`).style.width = (Math.max(0, s.cur)/s.h*100)+'%';
                    document.getElementById(`sp-${i}`).style.width = ((s.sp + 45)/90*100)+'%';
                }
            });
        }

        function addLog(tag, m) {
            const l = document.getElementById('log');
            l.innerHTML += `<div><span style="color:var(--accent)">[${tag}]</span> ${m}</div>`;
            l.scrollTop = l.scrollHeight;
        }
    </script>
</body>
</html>
